**Table of Contents.**
- Description Overview of the protocol.
- Full Representation of the Project's risk model.
    * Admin Abuse Risks.(Centralization/Owner type findings.).         
    * Systematic Risks(Contracts issues).
    * Integration Risks(Holders, Upgrades, Tokens).
    * Non-Token Standard.
- Software Engineering Considerations.
rewrite functions in an efficient manner,
modifiers, redundant functions, gas efficiency, use foundry for testing, more audits, version of Open zeppelin isn't recent, no determined/specific invariants
- In-depth architecture assessment of business logic.
user flows and functionalities of the protocol.
- Test suites.
coverage of the testing suites and bits of advice on areas to test.
- Weakspots and single points of failure.
- (Auditor's Note)











# Description Overview of the protocol.

Althea Liquid Infrastructure, Is a protocol conceived of a modular concept, drawing from a portable implementation of a revenue-generating NFT and then an ERC20 that can hold one or more of these revenue-generating NFTs. Where each NFT represents an asset or service in the real world, that generates on-chain/tokenized revenue to the NFTs, where a LiquidInfrastructurERC20, manages groups of this NFT, and when the revenue is generated it is distributed fairly amongst the holders of the LiquidInfrastructurERC20 token.
The protocol is unique in the sense that it creates a strong use case for crypto as it grows on real-world ideas and solves problems that people face daily tapping from the services people will use in their day-to-day lives.  
Here when users own the token they facilitate those services provided by Althea L1 Infrastructure and in turn they gain from the revenue generated from the services provided. 

## Graph chart of the systems architecture.
![AltheaInfrastructureDiagam drawio](https://github.com/shealtielanz/base/assets/126171088/3efbc81c-d0ec-4edc-9eed-49c016b9b5c2)

> [!NOTE]
> The above diagram is simplified to make the protocol easy to understand by a lame man.
# Full Representation of the Project's risk model.
The protocol contains every normal risk decentralized protocols contain, and the is the enigma of centralization, admin-associated risks, and normal blockchain/solidity issues. some of the following will be detailed below.
## Admin Abuse Risks. (Centralization/Owner type findings.).      
The owner/manager of the LiquidInfrastructureERC20 token, can.
- Approve Holders.
- Disapprove holders.
In a scenario of misconduct, the owner can wreck the holders.
> [!TIP] 
> Make use of a multi-sig wallet to avoid extreme scenarios like this.
This owner is in charge of polling the revenue generated by the NFTs to the LiquidInfrastructureERC20 token, this can be bad as they control the entire distribution system.
## Systematic Risks(Contracts issues).
Smart contract/Blockchain-related issues can be seen as loops with multiple transfers used during distribution and this could DOS the distribution system when past the block gas limit, though this was fairly handled I recommend a cap on the amount to be distributed, another issue is since smart contracts are immutable on-chain before deployment I recommend multiple audits and audits on the fixes made on previous audits.
## Integration Risks(Holders, Upgrades, Tokens).
Integration-related issues concern mainly the deployment of the modular contracts on the Althea L1 blockchain, since much isn't known about the chain this isn't much I can say on the one, but issues affecting the nature of the blockchain could deeply affect the LiquidInfrastructure modular contracts.
## Non-Token Standard.
Concerning token standards, the `entitlements` to be distributed to the different holders are calculated using the contract and the distributable token's balance, tokens with weird decimals should be considered in scenarios like this, since must be made to the holders before the end of a distribution, tokens with weird transfer logic should also be considered during integration with other tokens.
# Software Engineering Considerations.
The codebase of the protocol is fairly small and very efficiently written(concerning the approvals and the tokens logic), however, there are some considerations I would love to point out.
- Most functions are not gas efficient(eg the `distribute()`, `addManagedNFTS()`,`_beginDistribution()`)
> [!IMPORTANT] 
> Consider writing functions in a gas-efficient manner to reduce the cost of calling such functions on-chain. 

- Multiple functions contain very similar logic that could be efficiently put into one function.
- Repeated checks that could be made as modifiers.
- Input validations on important functions were overlooked.
> [!CAUTION]
> Lack of proper input validation can lead to different classes of bugs that can ruin the system and shame the protocol.

- Lack of access control on protocol damaging functions.

**Solution**

- Rewrite functions in a more gas-efficient manner,
- Modifiers can be used, 
- Redundant functions should be eliminated, gas efficiency, 
- Use foundry for testing, as it is more common amongst auditors.
- More audits, 
The latest version of Open Zeppelin should be used.
- Determine specific invariants.
- Fuzz/Invariant tests. 

# In-depth architecture assessment of business logic.
User flows and functionalities of the protocol.
> [!NOTE] 
> For better understanding consider taking a gander at the diagram above.

The functions and the flows are fairly easy to understand, as the restrictions are placed on transfers, minting, and burning to prevent manipulations during distribution.
> [!TIP] 
> Areas concerning the functions should be thoroughly audited and tested as if such actions can be done during distribution, revenue can be DOSed or stolen.

The Owner manages the LiquidInfrastructure System, by setting thresholds, adding distributable ERC20 tokens, withdrawing revenue to the LiquidINfra Token, managing the NFTs, sending out the NFTs, and more. Holders just gain revenue during distribution, and can transfer to their fellow holders. 
**Something to consider**
The tokens cannot to transferred to anyone who isn't approved by the owner, some issues that arise from this are:
- Circulation of the Liquid token is hindered,
- Since when a holder transfers out all their tokens they are no longer a holder or approved to hold the tokens, acquisition of such tokens will be very hard and tiring for both the soon-to-be holders and the owner, as they have to constantly be approving people before the can be in possession the liquidInfra tokens, also considering the gas cost and time it would the for the users to be approved, users may be disincentivized from holding such a token.

The protocol, techniques, and strategies for generating revenue are mind-blowing, as capitalizing on real-world assets using NFTs would drive the prices of such NFTs crazy, also the management and the simple-to-understand architecture and functionality of the protocol will make its adoption faster and smoother for users/investors hoping to join the Althea L1 protocol.
# Test suites.
coverage of the testing suites and bits of advice on areas to test.

The test suite mainly covered the approvals and the restrictions placed on the token during distribution, I recommend more fuzz tests, Invariant tests, and calculation tests concerning the manipulation of the holder's entitlements before or during distribution.

# Weakspots and single points of failure.
Mainly all these lie on the conduct of the owner of the Liquid token and anyone interacting with the protocol should be fully aware that the owner is a single point of failure to the system and any misconduct can be very detrimental to the holders of the Liquid Infra Tokens.













### (Auditor's Note) ~ Attacker's Mindset towards breaking or hacking the system.
While auditing the codebase, There were certain key areas and functionalities I sought to exploit namely:
- Earning more rewards as a holder, via manipulating the `erc20EntitlementPerUnit`. since it's calculated via the balance/supply if I could inflate the values I could get more rewards during distribution.
- DOSing the distribution of the rewards, or bricking distributions for some holders
- If I could bypass the restrictions placed on the token during distribution.
- Tested using different stable tokens on the system and how the system could handle that.
- Stealing NFTs owned by the contracts, or its revenue.

The approval of the system is tight though the main weak spot was in its ability to handle tokens with different decimals, and if a holder can revert transfers of any of the distributable tokens, it would brick the distribution process.

















### Time spent:
24 hours