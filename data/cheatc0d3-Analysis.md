# Althea Liquid Infrastructure Security Analysis Report

![Pic](https://code4rena.com/_next/image?url=https%3A%2F%2Fstorage.googleapis.com%2Fcdn-c4-uploads-v0%2Fuploads%2Fy3r4wwbxrwB.0&w=256&q=75)

## Overview of the Althea Liquid Infrastructure Project

The Althea Liquid Infrastructure Project introduces an innovative framework designed to bridge real-world infrastructure with decentralized finance (DeFi) through the Althea network. At its core, the project utilizes blockchain technology to represent infrastructure assets within an Althea pay-per-forward network as both non-fungible tokens (NFTs) and fungible tokens (ERC20), enabling automated services like internet provision to be seamlessly integrated into the blockchain ecosystem.

## Core Components and Mechanisms

#### 1. **Liquid Infrastructure NFT Contract**

- **Asset Tokenization**: Infrastructure assets are represented as NFTs, providing a direct link between physical assets and their digital counterparts on the blockchain. Each NFT corresponds to an account within the Cosmos Bank module, encapsulating the asset's financial activities and ownership within the Althea network.
  
- **Revenue Management**: The contract outlines methods for setting balance thresholds and withdrawing accumulated ERC20 tokens. These functionalities allow for the precise management of funds within each NFT, ensuring that revenue generated by the infrastructure is correctly allocated and accessible.
  
- **Account Recovery**: A notable feature is the recovery process for lost or compromised assets. The contract enables the initiation of a recovery phase, during which all funds from the linked Cosmos account are transferred to the NFT, safeguarding the asset's value and enabling its retrieval.

#### 2. **Liquid Infrastructure ERC20 Contract**

- **Revenue Distribution**: This contract acts as a collective investment vehicle, distributing revenue generated by the managed NFTs to ERC20 token holders. It details the distribution mechanics, ensuring that investors receive their fair share of earnings based on their token holdings.
  
- **Minting and Burning Restrictions**: To maintain fairness and stability in revenue distribution, the contract imposes restrictions on minting and burning activities. These are tied to the distribution period, preventing supply manipulation during critical financial operations.
  
- **Managed NFTs Integration**: The ERC20 contract provides functionalities for adding and releasing managed NFTs, centralizing control over the infrastructure assets. This integration is crucial for aggregating revenue and streamlining its distribution to investors.

#### 3. **Ownable Approvable ERC721 Contract**

- **Ownership and Approval Checks**: Extending the ERC721 standard, this abstract contract introduces modifiers for ownership and approval verification. It ensures that only authorized interactions with the NFTs are permitted, enhancing the security and integrity of asset management within the ecosystem.

## Evaluation Approach

When evaluating the Althea Liquid Infrastructure Project, my approach was methodical and focused on both the technical and operational aspects of the smart contracts. I began by manually reviewing each contract line by line, aiming to understand the intricacies of how the project tokenizes real-world infrastructure assets and manages the subsequent financial transactions within the blockchain framework.

**Technical Review**: My first step was a deep dive into the solidity code of each contract. This involved examining the functionality, security mechanisms, and the overall architecture to ensure that they align with best practices for smart contract development. Particular attention was given to the contracts' handling of ERC20 and ERC721 tokens, the implementation of ownership and approval checks, and the mechanisms for revenue distribution and account recovery.

**Operational Analysis**: Beyond the code, I assessed the contracts' operational capabilities, focusing on how they facilitate the tokenization of infrastructure, manage and distribute revenue, and ensure asset security. This included evaluating the user experience for asset owners and investors, the efficiency of the revenue distribution process, and the effectiveness of the recovery process for compromised assets.

**Security Assessment**: Security is paramount in DeFi projects. Thus, I scrutinized the contracts for common vulnerabilities, such as reentrancy attacks, improper access control, and potential for integer overflow/underflow. I also evaluated the contracts’ mechanisms for mitigating such risks, including the use of reentrancy guards and the solidity version's compliance with security standards.

**Performance Optimization**: Recognizing the importance of gas efficiency in blockchain operations, I reviewed the contracts for potential optimizations. This involved identifying unnecessary storage operations, inefficient loops, and opportunities to streamline transactions to reduce gas costs.

**Compliance and Future-Proofing**: Lastly, I considered the project’s adherence to regulatory standards and its preparedness for future upgrades. This included reviewing the contracts for upgradeability patterns, compliance with the latest ERC standards, and the flexibility of the contract design to accommodate new features or adjustments to the underlying blockchain technology.


## Architecture Overview

The architecture is built upon a foundation of Ethereum smart contracts, leveraging the ERC721 and ERC20 token standards to represent ownership and investment in infrastructure assets. This dual-token approach allows for unique identification of individual assets while also providing a mechanism for investors to share in the generated revenue.

#### Liquid Infrastructure NFT Contract

- **Role**: Serves as the cornerstone of the project, tokenizing infrastructure assets as NFTs. This contract encapsulates the ownership, management, and operational revenue of these assets.
- **Interactions**: Interfaces with the Cosmos Bank module to manage revenue flows and threshold balances for each tokenized asset. It also interacts with ERC20 tokens, facilitating the withdrawal of accumulated revenue into the Ethereum ecosystem.

#### Liquid Infrastructure ERC20 Contract

- **Role**: Acts as a collective investment vehicle, aggregating revenue from the NFTs and distributing it among ERC20 token holders.
- **Interactions**: Manages a portfolio of Liquid Infrastructure NFTs, drawing revenue from these assets. It also oversees the distribution process, ensuring that revenue is fairly allocated to investors based on their token holdings.

#### Ownable Approvable ERC721 Contract

- **Role**: Provides a secure framework for ownership and approval operations within the NFT contract, enhancing the project's security posture.
- **Interactions**: Enforces access control for critical functions, ensuring that only authorized users can perform sensitive actions, such as modifying asset thresholds or initiating the recovery process.

### Core Interactions

The project's core interactions are designed to ensure efficient management of the tokenized assets and the equitable distribution of revenue. Key interactions include:

- **Tokenization and Revenue Management**: Infrastructure assets are tokenized as NFTs, with each NFT representing a unique asset. These NFTs manage their own revenue thresholds and facilitate the withdrawal of excess revenue, which is then distributed to ERC20 token holders.
  
- **Revenue Distribution**: The ERC20 contract collects revenue from the managed NFTs and distributes it among its holders. This process is carefully orchestrated to ensure that distributions are made fairly and in proportion to the amount of ERC20 held by each investor.
  
- **Security and Access Control**: Through the Ownable Approvable ERC721 contract, the project implements robust security measures, including ownership verification and approval mechanisms. This ensures that only authorized actions can be taken on each NFT, protecting against unauthorized access and potential security threats.

## System Overview

### Scope

| Contract                       | SLOC | Purpose                                                                                              | Libraries Used       | Dependencies & Integrations |
|--------------------------------|------|------------------------------------------------------------------------------------------------------|----------------------|-----------------------------|
| `LiquidInfrastructureERC20.sol` | 270  | Manages the withdrawal of revenue from LiquidInfrastructureNFTs and its distribution to ERC20 holders. | `@openzeppelin/*`    | Cosmos Bank module, ERC20 token contracts |
| `LiquidInfrastructureNFT.sol`   | 88   | Represents infrastructure assets as ERC721 tokens, handling ERC20 balance accumulations and withdrawals. | `@openzeppelin/*`, `OwnableApprovableERC721` | ERC20 token contracts for revenue management |
| `OwnableApprovableERC721.sol`   | 19   | Provides an abstract contract with ownership and approval-based modifiers for ERC721 token interactions. | `@openzeppelin/*`    | ERC721 standard compliance for enhanced security features |

## Diagrams

1. **System Architecture Diagram:** https://i2.paste.pics/c9e661a77a231bacb917b857f88e389e.png?trs=812de04a20a9833ced18da7bb3334c6602e236c6c72744d5dee365dea45cb5d4&rand=LByTw1H42u

2. **Smart Contract Interaction Diagram:** https://i2.paste.pics/b50f7e392bf2013060329130ae0c306c.png?rand=eGpQnRH8jf

3. **Key Operations Diagram:** https://i2.paste.pics/3461c1f245373cddadf8bf62a839a188.png?trs=812de04a20a9833ced18da7bb3334c6602e236c6c72744d5dee365dea45cb5d4&rand=QadAXP8J3q

4. **Token Lifecycle Diagram** https://i2.paste.pics/a68a2ac0c5c652d903e28f90b7eba234.png?trs=812de04a20a9833ced18da7bb3334c6602e236c6c72744d5dee365dea45cb5d4&rand=xiWFTnohue

5. **Security Model Diagram** https://i2.paste.pics/6ab3ab86b8682113c3e95b1947815943.png?trs=812de04a20a9833ced18da7bb3334c6602e236c6c72744d5dee365dea45cb5d4&rand=aOMPzpf0JT

## Centralization Risks

The Althea Liquid Infrastructure Project exhibits certain centralization risks that could impact its security, governance, and overall operational resilience. These risks stem from the project's reliance on specific smart contracts and administrative controls, which, if not carefully managed, could lead to vulnerabilities or challenges in the project's decentralized ecosystem.

## Access Control Roles

The Access Control Roles in the Althea Liquid Infrastructure Project serve as a foundational security feature, delineating who can perform specific actions within the smart contracts. This structure is crucial for preventing unauthorized access and ensuring that operations such as revenue distribution and asset management are conducted securely and efficiently.

## Test Coverage

| File                            | % Statements | % Branch | % Functions | % Lines | Uncovered Lines       |
|---------------------------------|--------------|----------|-------------|---------|-----------------------|
| **Overall Project**             | **90.41%**   | **67.65%**| **91.43%**  | **90.12%** |                       |
| `LiquidInfrastructureERC20.sol` | 94.32%       | 63.1%    | 90.48%      | 92.66%  | ... 348,444,468       |
| `LiquidInfrastructureNFT.sol`   | 100%         | 85.71%   | 100%        | 100%    |                       |
| `OwnableApprovableERC721.sol`   | 100%         | 100%     | 100%        | 100%    |                       |


## Codebase Review

| Category            | Review                                                                                                                                                                                                                           |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Code Maintainability | The project smartly separates concerns by using distinct contracts (`LiquidInfrastructureERC20.sol`, `LiquidInfrastructureNFT.sol`, and `OwnableApprovableERC721.sol`) for different functionalities, enhancing maintainability. |
| Errors              | The system could benefit from implementing custom error types for more granular and efficient error handling, especially in complex interactions between contracts.                                                               |
| Events              | Events are thoughtfully utilized to log significant activities across contracts, facilitating transparency and aiding in debugging.                                                                                               |
| Code Readability    | The code is generally readable, with clear naming conventions, logical structuring, and appropriate commenting, which aids understanding and future modifications.                                                               |
| Gas Efficiency      | Usage of mappings and careful structuring contributes to gas efficiency. Opportunities for optimization might exist, such as minimizing state changes and exploring less inheritance in favor of composition or libraries.       |
| Code Style          | The project demonstrates strong adherence to the Solidity style guide, contributing to the code's readability and uniformity.                                                                                                    |
| Code Upgradability  | The current architecture does not explicitly address upgradability, potentially complicating future updates. Incorporating upgrade patterns or versioning mechanisms could enhance long-term flexibility.                        |
| Code Complexity     | The integration of ERC20 and ERC721 tokens, along with the management of revenue distribution and NFT functionalities, introduces complexity. It requires thorough testing to ensure reliability across scenarios.                |

## Findings

| Severity | Findings          |
|----------|-------------------|
| Critical | 0                 |
| High     | 0                 |
| Medium   | 0                 |
| Low      | 16                 |
| Gas      | 6                 |
| NC      | 1                 |

## Time Spent 

|            |            |
|------------|------------|
| Start Date | 18.02.2024 |
| End Date   | 19.02.2024 |
| Days spent | 2 Days     |
| Hours      | 20hrs        |




### Time spent:
20 hours