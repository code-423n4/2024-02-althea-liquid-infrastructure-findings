## Summary

### Gas Optimization

no |Issue   |Instances||
|-|:-|:-:|:-:|
| [G-01] |Use named returns for local variables of pure/view functions where it is possible|  |9|--| 
| [G-02] |Mappings not used externally/internally can be marked private  |  |1|--| 
| [G-03] |Redundant state variable getters |  |10|--| 
| [G-04] |Refactor functions to combine events to reduce gas cost |  |23|--| 
| [G-05] |Avoid unnecessary storage updates |  |2|--| 
| [G-06] |Optimizing Small Data Storage with Bytes32 |  |1|--| 
| [G-07] |Use of emit inside a loop |  |2|--| 
| [G-08] |inefficient Gas Usage in Solidity Smart Contracts Due to Long Error Messages  |  |42|--| 
| [G-09] |Consider Merge Sequential For-Loops  |  |2|--| 
| 




## Gas Optimizations  

## [G-1] Use named returns for local variables of pure functions where it is possible

```solidity
file:
96   function isApprovedHolder(address account) public view returns (bool) {
97     return HolderAllowlist[account];

243   function _isPastMinDistributionPeriod() internal view returns (bool) {
244        // Do not force a distribution with no holders or supply
245     if (totalSupply() == 0 || holders.length == 0) {
246            return false;
247        }
250        return (block.number - LastDistribution) >= MinDistributionPeriod    }
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L96-L97


```solidity
File: /liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol
 88       returns (address[] memory, uint256[] memory)

```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol#L88


## [G-2] Mappings not used externally/internally can be marked private 
in this case, since all mappings are declared as public, they can be accessed and modified by any external contract or account. If you do not need this level of accessibility, it's recommended to mark them as private to restrict their usage to within the contract where they are defined. This can help prevent unintended or malicious manipulation of the mapping data from external sources.
```solidity

file: /liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol
    mapping(address => bool) public HolderAllowlist;



```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L65


## [G-3] Redundant state variable getters
Getters for public state variables are automatically generated by the solidity compiler so there is no need to code them manually as this increases deployment cost. 

```solidity
file:/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol
    uint256 public constant Version = 1;

 54   uint256 public constant Version = 1;
 60   address[] public ManagedNFTs;
 70    uint256 public LastDistribution;
 75   uint256 public MinDistributionPeriod;
 80   bool public LockedForDistribution;
 85   uint256 internal nextDistributionRecipient;
 90    uint256 private nextWithdrawal;
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L54

```solidity
file: /liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol
46   uint256 public constant Version = 1;
53  uint256 public constant AccountId = 1;
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol#L46
```solidity

file: /liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol
 65   mapping(address => bool) public HolderAllowlist;



```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L65
## [G-4] Refactor functions to combine events to reduce gas cost
In scenarios where a function emits multiple event but these events are only emitted by that function we can combine these events to a single event in doing this we would save at least 1 Glog0 375 gas units

```solidity
file:
359   function withdrawFromManagedNFTs(uint256 numWithdrawals) public {
360       require(!LockedForDistribution, "cannot withdraw during distribution");

362        if (nextWithdrawal == 0) {
363            emit WithdrawalStarted();
364        }

366     uint256 limit = Math.min(
367           numWithdrawals + nextWithdrawal,
368            ManagedNFTs.length
369       );
370        uint256 i;
371        for (i = nextWithdrawal; i < limit; i++) {
372            LiquidInfrastructureNFT withdrawFrom = LiquidInfrastructureNFT(
373               ManagedNFTs[i]
            );

376            (address[] memory withdrawERC20s, ) = withdrawFrom.getThresholds();
377           withdrawFrom.withdrawBalancesTo(withdrawERC20s, address(this));
378           emit Withdrawal(address(withdrawFrom));
379        }
380        nextWithdrawal = i;

382        if (nextWithdrawal == ManagedNFTs.length) {
383            nextWithdrawal = 0;
384            emit WithdrawalFinished();
385       }
386    }

```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L359-L386

## [G-5] Avoid unnecessary storage updates
Avoid updating storage when the value hasnâ€™t changed. If the old value is equal to the new value, not re-storing the value will avoid a SSTORE operation (costing 2900 gas), potentially at the expense of a SLOAD operation (2100 gas) or a WARMACCESS operation (100 gas).


```solidity
file:/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol
  444      distributableERC20s = _distributableERC20s;
  471        MinDistributionPeriod = _minDistributionPeriod;
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L444

```solidity
file:

```


```solidity
file:

```


```solidity
file:

```


```solidity
file:

```


## [G-6] Optimizing Small Data Storage with Bytes32

his detector flags contracts that inefficiently use bytes and strings for small data that could fit into bytes32. Using bytes32 is cheaper in Solidity when the data can fit into 32 bytes.
```solidity
file:/liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol
 63       string memory accountName
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol#L63


## [G-7]Use of emit inside a loop
Emitting an event inside a loop performs a LOG op N times, where N is the loop length. This can lead to significant gas costs.

```solidity
file:/contracts/LiquidInfrastructureERC20.sol
   
   229             emit Distribution(recipient, distributableERC20s, receipts);
   475             emit Deployed();
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L229

## [G-8] inefficient Gas Usage in Solidity Smart Contracts Due to Long Error Messages 
if the string parameter of a require() or revert() function is longer than 32 bytes, it can lead to inefficiencies. This is because each extra memory word of bytes past the original 32 incurs an MSTORE operation, which costs 3 gas.
```

```solidity
file:/liquid-infrastructure/contracts/LiquidInfrastructureERC20.so
134         require(
135               isApprovedHolder(to),
136             "receiver not approved to hold the token" );

152       require(
153            !_isPastMinDistributionPeriod(),
154            "must distribute before minting or burning"
155        );

258         require(
259           !LockedForDistribution,
260          "cannot begin distribution when already locked"
261        );

287         require(
288           LockedForDistribution,
289            "cannot end distribution when not locked"
290        );

360        require(!LockedForDistribution, "cannot withdraw during distribution");

397       require(
398            nftOwner == address(this),
399            "this contract does not own the new ManagedNFT"
400        );

431        require(true, "unable to find released NFT in ManagedNFTs");
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L134-L136

```solidity
file:
112       require(
113          newErc20s.length == newAmounts.length,
114         "threshold values must have the same length"
115     );

136       require(
137            _isApprovedOrOwner(_msgSender(), AccountId),
138            "caller is not the owner of the Account token and is not approved either"
139        );

157        require(
158           _isApprovedOrOwner(_msgSender(), AccountId),
159            "caller is not the owner of the Account token and is not approved either"
160        );
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureNFT.sol#L112-L115

```solidity
file:contracts/OwnableApprovableERC721.sol
25       require(
26            ERC721(this).ownerOf(tokenId) == _msgSender(),
27            "OwnableApprovable: caller is not the owner"
28        );
```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/OwnableApprovableERC721.sol#L25-L28


## [G-9]Consider Merge Sequential For-Loops 
Detects instances where multiple for-loops appear sequentially in the same function. This may indicate an opportunity for loop fusion, a code optimization technique that merges multiple loops into a single one.
```solidity
file:/contracts/LiquidInfrastructureERC20.sol
214      for (i = nextDistributionRecipient; i < limit; i++) {
371      for (i = nextWithdrawal; i < limit; i++) {

```
https://github.com/code-423n4/2024-02-althea-liquid-infrastructure/blob/bd6ee47162368e1999a0a5b8b17b701347cf9a7d/liquid-infrastructure/contracts/LiquidInfrastructureERC20.sol#L214