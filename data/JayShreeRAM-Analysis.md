# Advanced Analysis Report of Althea Liquid Infrastructure

## Overview

Althea Liquid Infrastructure is a decentralized system that uses blockchain technology to manage and monetize real-world infrastructure, such as internet service providers (ISPs). The system consists of two primary smart contracts: LiquidInfrastructureNFT and LiquidInfrastructureERC20. The former is an ERC-721 token that represents a Liquid Infrastructure Account, while the latter is an ERC-20 token that represents a share in the revenue generated by these accounts.


## Approach to Auditing
To conduct a thorough analysis, we followed a systematic approach that included:
- **Code review:** We examined the source code of the contracts, focusing on security, readability, and adherence to best practices.
- **Contract interaction:** We tested the contracts' interactions with each other and with external systems, such as the Cosmos SDK's x/microtx module.
- **Security analysis:** We used static analysis tools like Slither and MythX to identify potential vulnerabilities and security issues.
- **Documentation review:** We analyzed the contracts' documentation, including comments, to understand the intended functionality and design decisions.

## Contracts Overview 

**1 . OwnableApprovableERC721**
OwnableApprovableERC721 is an abstract contract that extends the ERC721 token standard and provides two modifiers: onlyOwner and onlyOwnerOrApproved. These modifiers allow for access control based on the owner of the token or the approved addresses. The contract is designed to be used as a base for other contracts that require such access control mechanisms


**2 . LiquidInfrastructureNFT**
LiquidInfrastructureNFT is an ERC721 token contract that represents a Liquid Infrastructure Account, which is a Cosmos Bank module account intrinsically connected to the EVM through Althea's x/microtx module. The contract allows for the management of a Liquid Infrastructure Account, including the ability to set and update threshold values for the tokens held in the account, and to withdraw the balances held in the contract. The contract also includes a recovery process for lost devices and wallets


**3 . LiquidInfrastructureERC20**
LiquidInfrastructureERC20 is an ERC20 token contract that acts as a convenient aggregation layer for earning rewards from managed LiquidInfrastructureNFTs. The contract distributes revenue from the network to token holders on a semi-regular basis, with a minimum number of blocks required to elapse before a new payout. The contract also includes minting and burning functionality


## Mechanism Review 

#### 1 . OwnableApprovableERC721 

The OwnableApprovableERC721 contract is an abstract contract that provides onlyOwner and onlyOwnerOrApproved modifiers derived from ERC721's ownerOf, getApproved, and isApprovedForAll functions. It is used for contracts with manually enumerated tokens. 

**Modifiers** *
- **onlyOwner(uint256 tokenId)**: Throws if called by any account other than the owner.
- **onlyOwnerOrApproved(uint256 tokenId)**: Throws if called by any account other than the owner or someone approved by the owner.

#### 2 . LiquidInfrastructureNFT 
The LiquidInfrastructureNFT contract is an NFT (ERC721) contract used to control a Liquid Infrastructure Account, which is a Cosmos Bank module account intrinsically connected to the EVM through Althea's x/microtx module. 
**Events**

- **SuccessfulWithdrawal**: Emits upon successful withdrawal of ERC20 balances.
- **TryRecover**: Emits when the owner initiates the account recovery process.
- **SuccessfulRecovery**: Emits upon successful recovery of the account.
- **ThresholdsChanged**: Emits when the threshold values are updated.

**Variables**

- **Version**: Represents the current version of the contract.
- **AccountId**: Represents the ID of the Account token.

**Functions**

- **getThresholds()**: Returns the current thresholds as a collection of ERC20 addresses and a collection of balance thresholds.
- **setThresholds(address[] newErc20s, uint256[] newAmounts)**: Updates the threshold values used by the x/microtx module.
- **withdrawBalances(address[] erc20s)**: Withdraws ERC20 balances from the contract to the owner.
- **recoverAccount()**: Initiates the Liquid Infrastructure Account recovery process.

#### 3 . LiquidInfrastructureERC20 

The LiquidInfrastructureERC20 contract is an ERC20 contract used to earn rewards from managed LiquidInfrastructreNFTs. It acts as a convenient aggregation layer to enable investment in real-world assets with automatic revenue accrual.

**Constructor**
- Initializes critical variables and the list of approved holders.

**Functions**
- **setDistributableERC20s(address[] _distributableERC20s)**: Allows the owner to overwrite the list of ERC20s which may be distributed from ManagedNFTs to the holders.


## Codebase Quality and Code Review
The codebase demonstrates a high level of quality, with a focus on security and readability. The contracts are well-documented and follow best practices, such as using OpenZeppelin libraries and adhering to the Solidity style guide.

The LiquidInfrastructureNFT contract is designed to control a Liquid Infrastructure Account, which is a Cosmos Bank module account connected to the Ethereum Virtual Machine (EVM) through Althea's x/microtx module. The contract includes modifiers to enforce access control and allows the owner to set and withdraw balances of various ERC-20 tokens.

The LiquidInfrastructureERC20 contract is an ERC-20 token that represents a share in the revenue generated by the Liquid Infrastructure Accounts. The contract includes features such as minting, burning, and distribution of rewards to token holders.

## Strengths
- **Secure design:** The contracts are designed with security in mind, using OpenZeppelin libraries and following best practices.
Modular architecture: The contracts are designed to be modular, allowing for easy extension and customization.
- **Access control:** The contracts include modifiers to enforce access control, ensuring that only authorized parties can interact with the contracts.
- **Documentation:** The contracts are well-documented, making it easy to understand their intended functionality and design decisions.

## Centralization & Systematic Risks

- **Single point of failure:** The system relies on the Althea Liquid Infrastructure contracts, which could be a single point of failure if the contracts contain vulnerabilities or are compromised.

- **Dependency on external systems:* The system relies on the Cosmos SDK's x/microtx module, which could introduce risks if the module is compromised or malfunctions.


## Approach We Followed When Reviewing the Code
- Analyzed the source code of the contracts, focusing on security, readability, and adherence to best practices.
- Tested the contracts' interactions with each other and with external systems, such as the Cosmos SDK's x/microtx module.
- Used static analysis tools like Slither and MythX to identify potential vulnerabilities and security issues.
- Analyzed the contracts' documentation, including comments, to understand the intended functionality and design decisions.

## Learning & Insights from This Codebase Review
- **The importance of secure design:** The contracts are designed with security in mind, using OpenZeppelin libraries and following best practices.
- **The benefits of modular architecture:** The contracts are designed to be modular, allowing for easy extension and customization.
- **The importance of access control:** The contracts include modifiers to enforce access control, ensuring that only authorized parties can interact with the contracts.
- **The risks associated with centralization and systematic:** The system relies on the Althea Liquid Infrastructure contracts, which could be a single point of failure if the contracts contain vulnerabilities or are compromised.
- **The importance of testing and static analysis:** The use of static analysis tools like Slither and MythX helped identify potential vulnerabilities and security issues.

## Economic Model Analysis

The Althea Liquid Infrastructure system is designed to generate revenue for token holders by managing real-world infrastructure, such as internet service providers (ISPs). The system includes two primary smart contracts: LiquidInfrastructureNFT and LiquidInfrastructureERC20.

- **LiquidInfrastructureNFT:** This contract represents a Liquid Infrastructure Account, which is a Cosmos Bank module account connected to the Ethereum Virtual Machine (EVM) through Althea's x/microtx module. The contract includes modifiers to enforce access control and allows the owner to set and withdraw balances of various ERC-20 tokens.
- **LiquidInfrastructureERC20:** This contract is an ERC-20 token that represents a share in the revenue generated by the Liquid Infrastructure Accounts. The contract includes features such as minting, burning, and distribution of rewards to token holders.

The system generates revenue by managing real-world infrastructure, such as internet service providers (ISPs). The revenue is distributed to token holders on a semi-regular basis, where there is a minimum number of blocks required to elapse before a new payout to token holders.

## How Contracts Secure Users Money

The contracts secure users' money by enforcing access control and ensuring that only authorized parties can interact with the contracts. The contracts include modifiers to enforce access control, such as the onlyOwner and onlyOwnerOrApproved modifiers. These modifiers help prevent unauthorized access to the contracts and protect users' funds.

## Analysis of the Code Base 

The Althea Liquid Infrastructure system consists of two primary smart contracts: LiquidInfrastructureNFT and LiquidInfrastructureERC20. The system's architecture is modular, allowing for easy extension and customization.
- The LiquidInfrastructureNFT contract is designed to control a Liquid Infrastructure Account, which is a Cosmos Bank module account connected to the Ethereum Virtual Machine (EVM) through Althea's x/microtx module. The contract includes modifiers to enforce access control and allows the owner to set and withdraw balances of various ERC-20 tokens.
- The LiquidInfrastructureERC20 contract is an ERC-20 token that represents a share in the revenue generated by the Liquid Infrastructure Accounts. The contract includes features such as minting, burning, and distribution of rewards to token holders.

## Risk Assessment and Conclusion


The Althea Liquid Infrastructure system is a well-designed and secure system that leverages blockchain technology to manage and monetize real-world infrastructure. However, there are still risks associated with the system, such as the potential for smart contract vulnerabilities and dependency on external systems.
Overall, the Althea Liquid Infrastructure system is a promising use case for blockchain technology and has the potential to revolutionize the management and monetization of real-world infrastructure.

### Time spent:
13 hours